<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>校園鳥類觀察 AR 系統 - 實驗原型</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
      /* 控制介面板塊 */
      .ui-panel { 
        position: fixed; 
        bottom: 30px; 
        left: 50%; 
        transform: translateX(-50%); 
        width: 85%; 
        background: rgba(255, 255, 255, 0.95); 
        padding: 20px; 
        border-radius: 20px; 
        text-align: center; 
        z-index: 1000; 
        font-family: "Microsoft JhengHei", sans-serif;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      }
      #clue-text { 
        margin-bottom: 15px; 
        font-size: 18px;
        font-weight: bold; 
        color: #333; 
        line-height: 1.4;
      }
      button { 
        padding: 12px 25px; 
        font-size: 18px; 
        cursor: pointer; 
        background: #4CAF50; 
        color: white; 
        border: none; 
        border-radius: 10px; 
        transition: 0.3s;
      }
      button:active { background: #388E3C; }
    </style>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <div class="ui-panel">
      <div id="clue-text">請將相機對準 Hiro Marker 標記<br>準備好開始觀察了嗎？</div>
      <button id="next-btn" onclick="nextStep()">獲得線索 1：身體</button>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <a-marker preset="hiro" 
                smooth="true" 
                smoothCount="15" 
                smoothTolerance="0.01" 
                smoothThreshold="5">
        
        <a-image id="body" position="0 0 0" rotation="-90 0 0" width="2" height="1.12" visible="false" 
                 src="https://raw.githubusercontent.com/AglaeH/bird-ar-study/main/assets/sparrow/sparrow_body.png"></a-image>
        
        <a-image id="wing" position="0 0 0.01" rotation="-90 0 0" width="2" height="1.12" visible="false" 
                 src="https://raw.githubusercontent.com/AglaeH/bird-ar-study/main/assets/sparrow/sparrow_wing.png"></a-image>
        
        <a-image id="head" position="0 0 0.02" rotation="-90 0 0" width="2" height="1.12" visible="false" 
                 src="https://raw.githubusercontent.com/AglaeH/bird-ar-study/main/assets/sparrow/sparrow_head.png"></a-image>
        
        <a-image id="beak" position="0 0 0.03" rotation="-90 0 0" width="2" height="1.12" visible="false" 
                 src="https://raw.githubusercontent.com/AglaeH/bird-ar-study/main/assets/sparrow/sparrow_beak.png"></a-image>
        
        <a-image id="feet" position="0 0 0.04" rotation="-90 0 0" width="2" height="1.12" visible="false" 
                 src="https://raw.githubusercontent.com/AglaeH/bird-ar-study/main/assets/sparrow/sparrow_feet.png"></a-image>
      </a-marker>
      
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      let currentStep = 0;
      // 定義科學觀察步驟與線索
      const steps = [
        { id: 'body', clue: '線索 1：它有著棕色圓滾滾的身體。', btn: '選對了！下一關：翅膀' },
        { id: 'wing', clue: '線索 2：翅膀上有細小的黑白斑點。', btn: '選對了！下一關：頭部' },
        { id: 'head', clue: '線索 3：臉頰上有明顯的圓形大黑斑。', btn: '選對了！下一關：嘴巴' },
        { id: 'beak', clue: '線索 4：黑色的嘴喙呈現厚實的圓錐狀。', btn: '選對了！最後一關：腳' },
        { id: 'feet', clue: '線索 5：它的腳是淡肉色的。', btn: '完成麻雀觀察' }
      ];

      function nextStep() {
        const clueEl = document.getElementById('clue-text');
        const btnEl = document.getElementById('next-btn');

        if (currentStep < steps.length) {
          const item = steps[currentStep];
          
          // 讓對應的零件圖片顯示
          document.getElementById(item.id).setAttribute('visible', 'true');
          
          // 更新文字與按鈕
          clueEl.innerText = item.clue;
          btnEl.innerText = item.btn;
          
          currentStep++;
        } else {
          // 最終完成狀態
          clueEl.innerHTML = "<span style='color: #E91E63;'>恭喜！您已成功透過科學觀察完成麻雀組裝。</span>";
          btnEl.style.display = 'none'; // 隱藏按鈕，完成任務
        }
      }
    </script>
  </body>
</html>
